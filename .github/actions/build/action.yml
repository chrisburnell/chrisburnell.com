name: Build
description: Build the site

runs:
  using: composite
  steps:
    - name: Set up site cache
      id: cache-site
      uses: actions/cache@v4
      with:
        key: site-cache
        path: |
          .cache
          _site

    - name: Build with npm
      run: npm run build-production
      env:
        NODE_OPTIONS: "--max_old_space_size=8192"
        DARK_VISITORS_API_TOKEN: ${{ secrets.DARK_VISITORS_API_TOKEN }}
        LASTFM_API_TOKEN: ${{ secrets.LASTFM_API_TOKEN }}
        WEBMENTION_IO_TOKEN: ${{ secrets.WEBMENTION_IO_TOKEN }}
