<?xml version="1.0" encoding="utf-8" ?>
<?xml-stylesheet href="/feed.xsl" type="text/xsl" ?>
<feed xmlns:atom="http://www.w3.org/2005/Atom">
	<title>{{ site.title | striptags(true) }} â€“ {{ title | striptags(true) }}</title>
	<subtitle>{{ description | striptags(true) }}</subtitle>
	<link href="{{ site.url + page.url }}" rel="self"/>
	<link href="{{ site.url + '/' }}"/>
	<id>{{ site.url + '/' }}</id>
	<author>
		<name>{{ author.name }}</name>
		<uri>{{ site.url + '/' }}</uri>
		<email>{{ author.email }}</email>
	</author>
	<logo>{{ site.url + author.avatar }}</logo>
	<updated>{{ collections[related_collection] | getNewestCollectionItemDate | rfc3339Date }}</updated>
	<generator>{{ eleventy.generator }}</generator>
	<atom:link rel="self" href="{{ site.url + page.url }}" type="application/rss+xml" />
	<atom:link rel="hub" href="{{ author.urls.switchboard }}" />
	{%- for item in collections[related_collection] | limit(site.limits.feed) %}
	{%- set item_of = item.data.bookmark_of | default(item.data.drink_of) | default(item.data.like_of) | default(item.data.listen_of) | default(item.data.play_of) | default(item.data.read_of) | default(item.data.watch_of) -%}
	{%- set item_of_url = item_of -%}
	{%- if item_of.url -%}
		{% set item_of_url = item_of.url %}
	{%- endif -%}
	{%- set item_of_title = item_of_url -%}
	{%- if item_of.title -%}
		{% set item_of_title = item_of.title %}
	{%- endif -%}
	{%- if item.data.title or item_of_title -%}
		{% set item_title = item.data.title | default(item_of_title) %}
	{%- else -%}
		{% set item_date = item.date | friendlyDate | striptags(true) %}
		{% set item_title = item.data.category | title %}
		{% set item_title = item_title + " from " + item_date %}
	{%- endif -%}
	<entry>
		<id>{{ site.url + item.url }}</id>
		<title>{{ item_title | safe }}</title>
		<published>{{ item.date | rfc3339Date }}</published>
		<updated>{{ item.data.updated | default(item.date) | rfc3339Date }}</updated>
		<category term="{{ item.data.category }}" scheme="{{ site.url + '/' + item.data.category + '/' }}" />
		{% if item.data.description and item.content != '' -%}
		<summary>{{ item.data.description | markdownFormat | replace("\n", " ") | striptags(true) | safe }}</summary>
		<content xml:lang="{{ site.locale }}" type="html">
			{{ item.content | markdownFormat }}
		</content>
		{% elif not item.data.description and item.content != '' -%}
		<summary>{{ item.content | markdownFormat | replace("\n", " ") | striptags(true) | maxSentences(2) | safe }}</summary>
		<content xml:lang="{{ site.locale }}" type="html">
			{{ item.content | markdownFormat }}{% if item_of_url %}<p>Original post can be found at: <a href="{{ item_of_url }}">{{ item_of_title }}</a></p>{% endif %}
		</content>
		{% elif item.data.description and not item.content -%}
		<summary>{{ item.data.description | markdownFormat | replace("\n", " ") | striptags(true) | safe }}</summary>
		<content xml:lang="{{ site.locale }}" type="html">
			{% if item_of_url %}<p>Original post can be found at: <a href="{{ item_of_url }}">{{ item_of_title }}</a></p>{% endif %}
		</content>
		{% else -%}
		<summary>{{ item.data.categoryProperPlural | default(item.data.categoryPlural) | default(item.data.category) | title | safe }}</summary>
		<content xml:lang="{{ site.locale }}" type="html">
			{% if item_of_url %}<p>Original post can be found at: <a href="{{ item_of_url }}">{{ item_of_title }}</a></p>{% endif %}
		</content>
		{%- endif %}
		{% if item_of_url -%}
		<source>
			<id>{{ item_of_url }}</id>
			<title>{{ item_of_title | safe }}</title>
		</source>
		<atom:link rel="via" href="{{ item_of_url }}" />
		{%- endif %}
		{% if item.data.in_reply_to -%}
		<atom:link rel="related" href="{{ item.data.in_reply_to.url | default(item.data.in_reply_to) }}" />
		{%- endif %}
	</entry>
	{%- endfor %}
</feed>
