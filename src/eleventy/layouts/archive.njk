---
layout: base
hfeed: true
show_photos: true
truncate: true
---
{%- set collection = collections[related_collection] -%}
{%- set count = collection.length -%}
{%- set latest_year = collection[0].date.getFullYear() -%}
{%- set first_year = collection[count-1].date.getFullYear() -%}
{%- if limit -%}
	{% set collection = collection | limit(limit) %}
{%- endif -%}
<div class=" [ pantheon{% if full %}  full{% elif wide %}  wide{% endif %} ] [ wrap ] [ archive ] {% if perch %}[ perch ] {% endif %}">

	<ul class=" [ cluster ] [ breadcrumbs ] " hidden>
		<li><a href="/archive/">← All Posts</a></li>
	</ul>

	<h1 id="title" class=" [ title ] ">
		{%- if perch %}
			<span class=" [ perch ] [ p-name ] ">
				{{ title | safe }}
				<img src="{{ site.logo }}" alt="" width="324" height="324" loading="lazy" decoding="async" role="presentation" hidden>
			</span>
		{%- else -%}
			<span class=" [ p-name ] ">{{ title | safe }}</span>
		{%- endif %}
	</h1>

	<div class=" [ description ] [ flow ] [ p-summary ] ">
		{% if by_year %}
			<p>{{ description | replace('.', '') | safe }}{% if first_year != latest_year %}, dating from <a href="#{{ first_year }}">{{ first_year }}</a>–<a href="#{{ latest_year }}">{{ latest_year }}</a>{% endif %}.</p>
		{% else %}
			{{ description | markdownFormat | safe }}
		{% endif %}
	</div>

	{% if by_year %}
		{% sparkline collection, first_year, latest_year %}
	{% endif %}

	<div id="content" class=" [ content ] [ flow ] [ h-feed ] ">
		{% include 'css-naked-day.njk' %}

		{% include 'state-of-the-browser.njk' %}

		{%- if by_year -%}
			{%- set year = latest_year -%}
			<h2 id="{{ year }}">
				{{ year }} <small>{{ collection | getCollectionCount(year, true) }} post{{ 's' if collection | getCollectionCount(year, true) > 1 }}</small>
			</h2>
			<div id="list-{{ year }}" class=" [ deck ] ">
				{% for item in collection %}
					{% if item.date.getFullYear() != year %}
						{%- set year = item.date.getFullYear() -%}
						</div>
						<h2 id="{{ year }}">
							{{ year }} <small>{{ collection | getCollectionCount(year, true) }} post{{ 's' if collection | getCollectionCount(year, true) > 1 }}</small>
						</h2>
						<div id="list-{{ year }}" class=" [ deck ] ">
					{% endif %}
					{% include 'items/deck.njk' %}
				{% endfor %}
			</div>
		{%- else -%}
			<div class=" [ deck ] ">
				{% for item in collection %}
					{% include 'items/deck.njk' %}
				{% endfor %}
			</div>
		{%- endif -%}
	</div>

	<aside class=" [ meta ] [ flow ] " role="complementary">
		{% include 'meta/collection.njk' %}
	</aside>

	{% include 'ads.njk' %}
</div>
